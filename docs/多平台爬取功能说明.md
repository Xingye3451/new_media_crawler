# MediaCrawler 多平台爬取功能说明

## 🎯 功能概述

MediaCrawler 现已支持多平台并行爬取功能，可以同时对多个平台（小红书、抖音、快手、B站）进行内容爬取，统一数据格式存储到数据库中。

## ✨ 主要特性

### 1. 多平台并发爬取
- **支持平台**: 小红书、抖音、快手、B站
- **并发执行**: 多个平台同时爬取，提高效率
- **顺序执行**: 可选择顺序执行，降低服务器负载
- **统一数据格式**: 所有平台数据统一存储到 `unified_content`、`unified_creator`、`unified_comment` 表

### 2. 智能账号管理
- **智能选择**: 优先选择已登录账号，综合考虑成功率和使用频率
- **随机混用**: 随机选择可用账号
- **轮询使用**: 按顺序轮询使用账号
- **优先级使用**: 按优先级选择账号
- **单账号使用**: 固定使用单个账号

### 3. 灵活执行模式
- **并行执行**: 所有平台同时执行（推荐，效率高）
- **顺序执行**: 按顺序逐个执行（适合服务器负载较高时）

### 4. 统一数据存储
- **固定数据库存储**: 所有数据统一存储到数据库
- **统一表结构**: 使用 `unified_content`、`unified_creator`、`unified_comment` 表
- **数据关联**: 支持内容、创作者、评论的关联查询

## 🚀 使用方法

### 1. Web界面使用

1. 启动API服务器：
```bash
ENV=local python start_with_env.py
```

2. 打开浏览器访问：`http://localhost:8100`

3. 点击"多平台爬取"标签页

4. 配置爬取参数：
   - **选择平台**: 勾选要爬取的平台（可多选）
   - **搜索关键词**: 输入要搜索的关键词
   - **每平台最大数量**: 设置每个平台最多爬取的内容数量
   - **账号策略**: 选择账号使用策略
   - **执行模式**: 选择并行或顺序执行
   - **获取图片**: 是否下载图片内容

5. 点击"开始多平台爬取"按钮

6. 查看任务状态和结果

### 2. API接口使用

#### 启动多平台爬取任务

```bash
curl -X POST "http://localhost:8100/api/v1/multi-platform/start" \
  -H "Content-Type: application/json" \
  -d '{
    "platforms": ["xhs", "dy", "ks"],
    "keywords": "编程教程",
    "max_count_per_platform": 20,
    "enable_comments": false,
    "enable_images": false,
    "save_format": "db",
    "use_proxy": false,
    "proxy_strategy": "disabled",
    "account_strategy": "smart",
    "execution_mode": "parallel"
  }'
```

#### 查询任务状态

```bash
curl "http://localhost:8100/api/v1/multi-platform/status/{task_id}"
```

## 📊 参数说明

### 请求参数

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `platforms` | List[str] | ✅ | - | 平台列表：["xhs", "dy", "ks", "bili"] |
| `keywords` | str | ✅ | - | 搜索关键词 |
| `max_count_per_platform` | int | ❌ | 50 | 每个平台最大爬取数量 |
| `enable_comments` | bool | ❌ | false | 是否获取评论（待开发） |
| `enable_images` | bool | ❌ | false | 是否获取图片 |
| `save_format` | str | ❌ | "db" | 保存格式（固定为数据库） |
| `use_proxy` | bool | ❌ | false | 是否使用代理 |
| `proxy_strategy` | str | ❌ | "disabled" | 代理策略 |
| `account_strategy` | str | ❌ | "smart" | 账号策略 |
| `execution_mode` | str | ❌ | "parallel" | 执行模式 |

### 账号策略说明

| 策略 | 说明 | 适用场景 |
|------|------|----------|
| `smart` | 智能选择：优先已登录账号，综合考虑成功率和使用频率 | 推荐使用 |
| `random` | 随机混用：随机选择可用账号 | 负载均衡 |
| `round_robin` | 轮询使用：按顺序轮询使用账号 | 平均分配 |
| `priority` | 优先级使用：按优先级选择账号 | 特定需求 |
| `single` | 单账号使用：固定使用单个账号 | 测试或限制场景 |

### 执行模式说明

| 模式 | 说明 | 适用场景 |
|------|------|----------|
| `parallel` | 并行执行：所有平台同时执行 | 推荐，效率高 |
| `sequential` | 顺序执行：按顺序逐个执行 | 服务器负载较高时 |

## 📈 任务状态说明

### 任务状态类型

| 状态 | 说明 |
|------|------|
| `pending` | 等待执行 |
| `running` | 正在执行 |
| `completed` | 执行完成（全部成功） |
| `completed_with_errors` | 执行完成（部分失败） |
| `failed` | 执行失败 |

## 🚨 注意事项

### 1. 登录要求
- 各平台需要先进行远程登录
- 系统会自动检查登录状态
- 登录失败的平台会被跳过

### 2. 资源限制
- 并行执行时注意服务器资源消耗
- 建议根据服务器配置调整并发数
- 大量任务时建议使用顺序执行

### 3. 数据一致性
- 所有数据统一存储到数据库
- 支持事务处理确保数据一致性
- 失败的任务不会影响已成功的数据

## 🧪 测试验证

运行测试脚本：
```bash
python test_multi_platform_crawler.py
```

---

**注意**: 本功能仅供学习研究使用，请遵守相关平台的使用条款和法律法规。 