<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaCrawler 爬虫配置管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .config-card {
            transition: all 0.3s ease;
            border-left: 4px solid #dee2e6;
        }
        .config-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .config-card.active {
            border-left-color: #007bff;
            background-color: #f8f9fa;
        }
        .resource-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .resource-normal { background-color: #28a745; }
        .resource-warning { background-color: #ffc107; }
        .resource-danger { background-color: #dc3545; }
        .config-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .platform-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        .config-value {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3 col-lg-2 bg-light p-3">
                <h5 class="mb-3">
                    <i class="bi bi-gear"></i> 配置管理
                </h5>
                
                <!-- 平台配置 -->
                <div class="mb-4">
                    <h6>平台配置</h6>
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action" data-platform="xhs">
                            <i class="bi bi-camera-video platform-icon"></i>小红书
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" data-platform="dy">
                            <i class="bi bi-camera-video platform-icon"></i>抖音
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" data-platform="ks">
                            <i class="bi bi-camera-video platform-icon"></i>快手
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" data-platform="bili">
                            <i class="bi bi-camera-video platform-icon"></i>B站
                        </a>
                    </div>
                </div>

                <!-- 配置预设 -->
                <div class="mb-4">
                    <h6>配置预设</h6>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="loadPreset('conservative')">
                            保守模式
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="loadPreset('balanced')">
                            平衡模式
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="loadPreset('aggressive')">
                            激进模式
                        </button>
                    </div>
                </div>

                <!-- 系统状态 -->
                <div class="mb-4">
                    <h6>系统状态</h6>
                    <div class="small">
                        <div class="mb-2">
                            <span class="resource-indicator resource-normal"></span>
                            CPU: <span id="cpu-usage">--</span>%
                        </div>
                        <div class="mb-2">
                            <span class="resource-indicator resource-normal"></span>
                            内存: <span id="memory-usage">--</span>%
                        </div>
                        <div class="mb-2">
                            <span class="resource-indicator resource-normal"></span>
                            磁盘: <span id="disk-usage">--</span>%
                        </div>
                    </div>
                </div>

                <!-- 快捷操作 -->
                <div class="mb-4">
                    <h6>快捷操作</h6>
                    <div class="d-grid gap-2">
                        <button class="btn btn-success btn-sm" onclick="saveAllConfigs()">
                            <i class="bi bi-save"></i> 保存所有配置
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="resetAllConfigs()">
                            <i class="bi bi-arrow-clockwise"></i> 重置配置
                        </button>
                        <button class="btn btn-info btn-sm" onclick="exportConfigs()">
                            <i class="bi bi-download"></i> 导出配置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-9 col-lg-10 p-4">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-sliders"></i> 
                                    <span id="current-platform">小红书</span> 爬虫配置
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="crawlerConfigForm">
                                    <!-- 基础配置 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-gear"></i> 基础配置</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">默认关键词</label>
                                                <input type="text" class="form-control" id="defaultKeywords" placeholder="编程副业,编程兼职">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">默认爬取数量</label>
                                                <input type="number" class="form-control" id="defaultMaxCount" value="20" min="1" max="100">
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label class="form-label">默认爬虫类型</label>
                                                <select class="form-select" id="defaultCrawlerType">
                                                    <option value="search">关键词搜索</option>
                                                    <option value="detail">指定内容详情</option>
                                                    <option value="creator">创作者主页</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">默认登录类型</label>
                                                <select class="form-select" id="defaultLoginType">
                                                    <option value="qrcode">二维码登录</option>
                                                    <option value="phone">手机号登录</option>
                                                    <option value="cookie">Cookie登录</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 功能开关 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-toggle-on"></i> 功能开关</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enableComments">
                                                    <label class="form-check-label">获取评论</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enableSubComments">
                                                    <label class="form-check-label">获取子评论</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enableImages">
                                                    <label class="form-check-label">获取图片</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enableVideos">
                                                    <label class="form-check-label">获取视频</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 资源控制 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-speedometer2"></i> 资源控制</h6>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="form-label">最大并发数</label>
                                                <input type="number" class="form-control" id="maxConcurrency" value="2" min="1" max="5">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">请求间隔(秒)</label>
                                                <input type="number" class="form-control" id="sleepInterval" value="5" min="1" max="30">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">超时时间(秒)</label>
                                                <input type="number" class="form-control" id="timeoutSeconds" value="300" min="60" max="1800">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 代理设置 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-globe"></i> 代理设置</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="useProxy">
                                                    <label class="form-check-label">启用代理</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">代理策略</label>
                                                <select class="form-select" id="proxyStrategy">
                                                    <option value="disabled">禁用</option>
                                                    <option value="round_robin">轮询</option>
                                                    <option value="random">随机</option>
                                                    <option value="weighted">权重</option>
                                                    <option value="failover">故障转移</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 数据存储 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-database"></i> 数据存储</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">存储方式</label>
                                                <select class="form-select" id="saveDataOption">
                                                    <option value="db">数据库存储</option>
                                                    <option value="json">JSON文件</option>
                                                    <option value="csv">CSV文件</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">数据保留天数</label>
                                                <input type="number" class="form-control" id="dataRetentionDays" value="30" min="1" max="365">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 平台特定配置 -->
                                    <div class="config-section">
                                        <h6><i class="bi bi-puzzle"></i> 平台特定配置</h6>
                                        <div id="platformSpecificConfig">
                                            <!-- 平台特定配置将在这里动态加载 -->
                                        </div>
                                    </div>

                                    <!-- 操作按钮 -->
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-primary" onclick="saveCurrentConfig()">
                                            <i class="bi bi-save"></i> 保存当前配置
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="loadCurrentConfig()">
                                            <i class="bi bi-arrow-clockwise"></i> 重新加载
                                        </button>
                                        <button type="button" class="btn btn-warning" onclick="resetCurrentConfig()">
                                            <i class="bi bi-arrow-counterclockwise"></i> 重置配置
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 配置概览 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-list-ul"></i> 配置概览
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="configOverview">
                                    <!-- 配置概览将在这里显示 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let currentPlatform = 'xhs';
        let platformConfigs = {};
        let resourceMonitor = null;

        // 平台配置模板
        const platformTemplates = {
            xhs: {
                defaultKeywords: '编程副业,编程兼职',
                defaultMaxCount: 20,
                defaultCrawlerType: 'search',
                defaultLoginType: 'qrcode',
                enableComments: true,
                enableSubComments: false,
                enableImages: false,
                enableVideos: true,
                maxConcurrency: 2,
                sleepInterval: 5,
                timeoutSeconds: 300,
                useProxy: false,
                proxyStrategy: 'disabled',
                saveDataOption: 'db',
                dataRetentionDays: 30,
                platformSpecific: {
                    searchNoteType: 'video',
                    enableVideoFilter: true
                }
            },
            dy: {
                defaultKeywords: '编程教程,技术分享',
                defaultMaxCount: 25,
                defaultCrawlerType: 'search',
                defaultLoginType: 'qrcode',
                enableComments: true,
                enableSubComments: false,
                enableImages: false,
                enableVideos: true,
                maxConcurrency: 3,
                sleepInterval: 3,
                timeoutSeconds: 300,
                useProxy: false,
                proxyStrategy: 'disabled',
                saveDataOption: 'db',
                dataRetentionDays: 30,
                platformSpecific: {
                    publishTimeType: 0,
                    enableVideoFilter: true
                }
            },
            ks: {
                defaultKeywords: '编程学习,技术分享',
                defaultMaxCount: 20,
                defaultCrawlerType: 'search',
                defaultLoginType: 'qrcode',
                enableComments: true,
                enableSubComments: false,
                enableImages: false,
                enableVideos: true,
                maxConcurrency: 2,
                sleepInterval: 4,
                timeoutSeconds: 300,
                useProxy: false,
                proxyStrategy: 'disabled',
                saveDataOption: 'db',
                dataRetentionDays: 30,
                platformSpecific: {
                    enableVideoFilter: true
                }
            },
            bili: {
                defaultKeywords: '编程教程,技术分享',
                defaultMaxCount: 30,
                defaultCrawlerType: 'search',
                defaultLoginType: 'qrcode',
                enableComments: true,
                enableSubComments: false,
                enableImages: false,
                enableVideos: true,
                maxConcurrency: 2,
                sleepInterval: 5,
                timeoutSeconds: 300,
                useProxy: false,
                proxyStrategy: 'disabled',
                saveDataOption: 'db',
                dataRetentionDays: 30,
                platformSpecific: {
                    allDay: false,
                    startDay: '2024-01-01',
                    endDay: '2024-01-31',
                    creatorMode: false
                }
            }
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePlatformSelection();
            loadCurrentConfig();
            startResourceMonitoring();
        });

        // 平台选择
        function initializePlatformSelection() {
            document.querySelectorAll('[data-platform]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 更新选中状态
                    document.querySelectorAll('[data-platform]').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新当前平台
                    currentPlatform = this.dataset.platform;
                    document.getElementById('current-platform').textContent = getPlatformName(currentPlatform);
                    
                    // 加载平台配置
                    loadCurrentConfig();
                });
            });
            
            // 默认选择小红书
            document.querySelector('[data-platform="xhs"]').classList.add('active');
        }

        // 加载当前平台配置
        async function loadCurrentConfig() {
            try {
                // 从配置管理API获取当前配置
                const response = await fetch(`/api/v1/config/load/${currentPlatform}`);
                const data = await response.json();
                
                if (data.config) {
                    // 填充表单
                    fillFormWithConfig(data.config);
                } else {
                    // 使用默认模板
                    fillFormWithConfig(platformTemplates[currentPlatform]);
                }
                
                updateConfigOverview();
            } catch (error) {
                console.error('加载配置失败:', error);
                // 使用默认模板
                fillFormWithConfig(platformTemplates[currentPlatform]);
                updateConfigOverview();
            }
        }

        // 用配置填充表单
        function fillFormWithConfig(config) {
            // 基础配置
            document.getElementById('defaultKeywords').value = config.defaultKeywords || '';
            document.getElementById('defaultMaxCount').value = config.defaultMaxCount || 20;
            document.getElementById('defaultCrawlerType').value = config.defaultCrawlerType || 'search';
            document.getElementById('defaultLoginType').value = config.defaultLoginType || 'qrcode';
            
            // 功能开关
            document.getElementById('enableComments').checked = config.enableComments || false;
            document.getElementById('enableSubComments').checked = config.enableSubComments || false;
            document.getElementById('enableImages').checked = config.enableImages || false;
            document.getElementById('enableVideos').checked = config.enableVideos || false;
            
            // 资源控制
            document.getElementById('maxConcurrency').value = config.maxConcurrency || 2;
            document.getElementById('sleepInterval').value = config.sleepInterval || 5;
            document.getElementById('timeoutSeconds').value = config.timeoutSeconds || 300;
            
            // 代理设置
            document.getElementById('useProxy').checked = config.useProxy || false;
            document.getElementById('proxyStrategy').value = config.proxyStrategy || 'disabled';
            
            // 数据存储
            document.getElementById('saveDataOption').value = config.saveDataOption || 'db';
            document.getElementById('dataRetentionDays').value = config.dataRetentionDays || 30;
            
            // 平台特定配置
            loadPlatformSpecificConfig(config.platformSpecific);
        }

        // 加载平台特定配置
        function loadPlatformSpecificConfig(specificConfig) {
            const container = document.getElementById('platformSpecificConfig');
            
            switch (currentPlatform) {
                case 'xhs':
                    container.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">搜索笔记类型</label>
                                <select class="form-select" id="searchNoteType">
                                    <option value="ALL">全部</option>
                                    <option value="VIDEO">仅视频</option>
                                    <option value="IMAGE">仅图片</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enableVideoFilter">
                                    <label class="form-check-label">启用视频过滤</label>
                                </div>
                            </div>
                        </div>
                    `;
                    if (specificConfig) {
                        document.getElementById('searchNoteType').value = specificConfig.searchNoteType || 'VIDEO';
                        document.getElementById('enableVideoFilter').checked = specificConfig.enableVideoFilter || true;
                    }
                    break;
                    
                case 'dy':
                    container.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">发布时间类型</label>
                                <select class="form-select" id="publishTimeType">
                                    <option value="0">全部时间</option>
                                    <option value="1">最近一天</option>
                                    <option value="2">最近一周</option>
                                    <option value="3">最近一月</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enableVideoFilter">
                                    <label class="form-check-label">启用视频过滤</label>
                                </div>
                            </div>
                        </div>
                    `;
                    if (specificConfig) {
                        document.getElementById('publishTimeType').value = specificConfig.publishTimeType || 0;
                        document.getElementById('enableVideoFilter').checked = specificConfig.enableVideoFilter || true;
                    }
                    break;
                    
                case 'bili':
                    container.innerHTML = `
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="allDay">
                                    <label class="form-check-label">全天候爬取</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">开始日期</label>
                                <input type="date" class="form-control" id="startDay">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">结束日期</label>
                                <input type="date" class="form-control" id="endDay">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="creatorMode">
                                    <label class="form-check-label">创作者模式</label>
                                </div>
                            </div>
                        </div>
                    `;
                    if (specificConfig) {
                        document.getElementById('allDay').checked = specificConfig.allDay || false;
                        document.getElementById('startDay').value = specificConfig.startDay || '2024-01-01';
                        document.getElementById('endDay').value = specificConfig.endDay || '2024-01-31';
                        document.getElementById('creatorMode').checked = specificConfig.creatorMode || false;
                    }
                    break;
                    
                default:
                    container.innerHTML = '<p class="text-muted">该平台暂无特定配置</p>';
            }
        }

        // 保存当前配置
        async function saveCurrentConfig() {
            const config = getCurrentConfig();
            
            try {
                const response = await fetch(`/api/v1/config/save/${currentPlatform}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });

                const data = await response.json();
                
                if (response.ok) {
                    showAlert('配置保存成功', 'success');
                    updateConfigOverview();
                } else {
                    showAlert('保存失败: ' + data.detail, 'danger');
                }
            } catch (error) {
                showAlert('保存失败: ' + error.message, 'danger');
            }
        }

        // 获取当前配置
        function getCurrentConfig() {
            const config = {
                platform: currentPlatform,
                defaultKeywords: document.getElementById('defaultKeywords').value,
                defaultMaxCount: parseInt(document.getElementById('defaultMaxCount').value),
                defaultCrawlerType: document.getElementById('defaultCrawlerType').value,
                defaultLoginType: document.getElementById('defaultLoginType').value,
                enableComments: document.getElementById('enableComments').checked,
                enableSubComments: document.getElementById('enableSubComments').checked,
                enableImages: document.getElementById('enableImages').checked,
                enableVideos: document.getElementById('enableVideos').checked,
                maxConcurrency: parseInt(document.getElementById('maxConcurrency').value),
                sleepInterval: parseInt(document.getElementById('sleepInterval').value),
                timeoutSeconds: parseInt(document.getElementById('timeoutSeconds').value),
                useProxy: document.getElementById('useProxy').checked,
                proxyStrategy: document.getElementById('proxyStrategy').value,
                saveDataOption: document.getElementById('saveDataOption').value,
                dataRetentionDays: parseInt(document.getElementById('dataRetentionDays').value)
            };

            // 添加平台特定配置
            config.platformSpecific = getPlatformSpecificConfig();

            return config;
        }

        // 获取平台特定配置
        function getPlatformSpecificConfig() {
            const specific = {};
            
            switch (currentPlatform) {
                case 'xhs':
                    specific.searchNoteType = document.getElementById('searchNoteType')?.value || 'VIDEO';
                    specific.enableVideoFilter = document.getElementById('enableVideoFilter')?.checked || true;
                    break;
                case 'dy':
                    specific.publishTimeType = parseInt(document.getElementById('publishTimeType')?.value || 0);
                    specific.enableVideoFilter = document.getElementById('enableVideoFilter')?.checked || true;
                    break;
                case 'bili':
                    specific.allDay = document.getElementById('allDay')?.checked || false;
                    specific.startDay = document.getElementById('startDay')?.value || '2024-01-01';
                    specific.endDay = document.getElementById('endDay')?.value || '2024-01-31';
                    specific.creatorMode = document.getElementById('creatorMode')?.checked || false;
                    break;
            }
            
            return specific;
        }

        // 重置当前配置
        function resetCurrentConfig() {
            if (confirm('确定要重置当前平台的配置吗？')) {
                fillFormWithConfig(platformTemplates[currentPlatform]);
                updateConfigOverview();
                showAlert('配置已重置', 'warning');
            }
        }

        // 加载配置预设
        async function loadPreset(preset) {
            try {
                const response = await fetch('/api/v1/config/preset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        preset: preset,
                        platform: currentPlatform
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // 重新加载配置
                    await loadCurrentConfig();
                    showAlert(`已应用${preset}预设配置`, 'success');
                } else {
                    showAlert('应用预设失败: ' + data.detail, 'danger');
                }
            } catch (error) {
                showAlert('应用预设失败: ' + error.message, 'danger');
            }
        }

        // 更新配置概览
        function updateConfigOverview() {
            const config = getCurrentConfig();
            const overview = document.getElementById('configOverview');
            
            overview.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>基础配置</h6>
                        <p><strong>默认关键词:</strong> <span class="config-value">${config.defaultKeywords}</span></p>
                        <p><strong>最大数量:</strong> <span class="config-value">${config.defaultMaxCount}</span></p>
                        <p><strong>爬虫类型:</strong> <span class="config-value">${config.defaultCrawlerType}</span></p>
                        <p><strong>登录类型:</strong> <span class="config-value">${config.defaultLoginType}</span></p>
                    </div>
                    <div class="col-md-6">
                        <h6>功能开关</h6>
                        <p><strong>获取评论:</strong> <span class="config-value">${config.enableComments ? '✅' : '❌'}</span></p>
                        <p><strong>获取图片:</strong> <span class="config-value">${config.enableImages ? '✅' : '❌'}</span></p>
                        <p><strong>获取视频:</strong> <span class="config-value">${config.enableVideos ? '✅' : '❌'}</span></p>
                        <p><strong>代理使用:</strong> <span class="config-value">${config.useProxy ? '✅' : '❌'}</span></p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>资源控制</h6>
                        <p><strong>最大并发:</strong> <span class="config-value">${config.maxConcurrency}</span></p>
                        <p><strong>请求间隔:</strong> <span class="config-value">${config.sleepInterval}s</span></p>
                        <p><strong>超时时间:</strong> <span class="config-value">${config.timeoutSeconds}s</span></p>
                    </div>
                    <div class="col-md-6">
                        <h6>数据存储</h6>
                        <p><strong>存储方式:</strong> <span class="config-value">${config.saveDataOption}</span></p>
                        <p><strong>保留天数:</strong> <span class="config-value">${config.dataRetentionDays}天</span></p>
                    </div>
                </div>
            `;
        }

        // 保存所有配置
        async function saveAllConfigs() {
            try {
                const response = await fetch('/api/v1/config/save-all', {
                    method: 'POST'
                });

                const data = await response.json();
                
                if (response.ok) {
                    showAlert(`已保存 ${data.saved_count} 个平台配置`, 'success');
                } else {
                    showAlert('保存所有配置失败: ' + data.detail, 'danger');
                }
            } catch (error) {
                showAlert('保存所有配置失败: ' + error.message, 'danger');
            }
        }

        // 重置所有配置
        async function resetAllConfigs() {
            if (confirm('确定要重置所有平台的配置吗？这将恢复默认设置。')) {
                try {
                    const response = await fetch('/api/v1/config/reset-all', {
                        method: 'POST'
                    });

                    const data = await response.json();
                    
                    if (response.ok) {
                        showAlert(`已重置 ${data.reset_count} 个平台配置`, 'success');
                        // 重新加载当前配置
                        await loadCurrentConfig();
                    } else {
                        showAlert('重置所有配置失败: ' + data.detail, 'danger');
                    }
                } catch (error) {
                    showAlert('重置所有配置失败: ' + error.message, 'danger');
                }
            }
        }

        // 导出配置
        async function exportConfigs() {
            try {
                const response = await fetch('/api/v1/config/export');
                const data = await response.json();
                
                if (response.ok) {
                    // 创建下载链接
                    const dataStr = JSON.stringify(data.configs, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `crawler_configs_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    showAlert('配置已导出', 'success');
                } else {
                    showAlert('导出配置失败: ' + data.detail, 'danger');
                }
            } catch (error) {
                showAlert('导出配置失败: ' + error.message, 'danger');
            }
        }

        // 资源监控
        function startResourceMonitoring() {
            resourceMonitor = setInterval(async () => {
                try {
                    // 模拟资源监控数据
                    const cpuUsage = Math.floor(Math.random() * 100);
                    const memoryUsage = Math.floor(Math.random() * 100);
                    const diskUsage = Math.floor(Math.random() * 100);

                    document.getElementById('cpu-usage').textContent = cpuUsage;
                    document.getElementById('memory-usage').textContent = memoryUsage;
                    document.getElementById('disk-usage').textContent = diskUsage;

                    // 更新资源指示器
                    updateResourceIndicator('cpu', cpuUsage);
                    updateResourceIndicator('memory', memoryUsage);
                    updateResourceIndicator('disk', diskUsage);
                } catch (error) {
                    console.error('资源监控失败:', error);
                }
            }, 5000);
        }

        function updateResourceIndicator(type, usage) {
            const indicator = document.querySelector(`#${type}-usage`).previousElementSibling;
            indicator.className = 'resource-indicator';
            
            if (usage < 60) {
                indicator.classList.add('resource-normal');
            } else if (usage < 80) {
                indicator.classList.add('resource-warning');
            } else {
                indicator.classList.add('resource-danger');
            }
        }

        // 工具函数
        function getPlatformName(platform) {
            const names = {
                'xhs': '小红书',
                'dy': '抖音',
                'ks': '快手',
                'bili': 'B站'
            };
            return names[platform] || platform;
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.insertBefore(alertDiv, document.body.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html> 
</html> 