<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç›‘æ§ - MediaCrawler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .monitor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .monitor-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
        }

        .metric-unit {
            font-size: 0.8em;
            color: #999;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        .process-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .process-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
        }

        .process-info {
            flex: 1;
        }

        .process-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .process-details {
            font-size: 0.85em;
            color: #666;
        }

        .process-stats {
            text-align: right;
        }

        .process-cpu {
            color: #dc3545;
            font-weight: bold;
        }

        .process-memory {
            color: #28a745;
            font-weight: bold;
        }

        .warning-list {
            list-style: none;
        }

        .warning-item {
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            margin-bottom: 8px;
            color: #856404;
        }

        .warning-item::before {
            content: "âš ï¸ ";
            margin-right: 8px;
        }

        .health-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .health-healthy {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .health-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .health-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            background: #667eea;
            color: white;
        }

        .control-btn:hover {
            background: #5a6fd8;
        }

        .control-btn.secondary {
            background: #6c757d;
        }

        .control-btn.secondary:hover {
            background: #5a6268;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .monitor-grid {
                grid-template-columns: 1fr;
            }
            
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">
        â† è¿”å›é¦–é¡µ
    </a>

    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç³»ç»Ÿç›‘æ§</h1>
            <p>å®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µã€è¿›ç¨‹çŠ¶æ€å’Œç³»ç»Ÿå¥åº·åº¦</p>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="control-btn" onclick="refreshAllData()">
                ğŸ”„ åˆ·æ–°æ•°æ®
            </button>
            <button class="control-btn secondary" onclick="toggleAutoRefresh()">
                â±ï¸ è‡ªåŠ¨åˆ·æ–°
            </button>
            <button class="control-btn secondary" onclick="exportSystemReport()">
                ğŸ“¤ å¯¼å‡ºæŠ¥å‘Š
            </button>
        </div>

        <!-- ç³»ç»Ÿå¥åº·çŠ¶æ€ -->
        <div class="monitor-card full-width" id="healthCard">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">ğŸ¥</span>
                    ç³»ç»Ÿå¥åº·çŠ¶æ€
                </div>
                <button class="refresh-btn" onclick="loadSystemHealth()">åˆ·æ–°</button>
            </div>
            <div id="healthContent">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- èµ„æºä½¿ç”¨æƒ…å†µ -->
        <div class="monitor-grid">
            <!-- CPUå’Œå†…å­˜ -->
            <div class="monitor-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">ğŸ–¥ï¸</span>
                        CPU & å†…å­˜
                    </div>
                    <button class="refresh-btn" onclick="loadResourceUsage()">åˆ·æ–°</button>
                </div>
                <div id="cpuMemoryContent">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <!-- ç£ç›˜å’Œç½‘ç»œ -->
            <div class="monitor-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">ğŸ’¾</span>
                        ç£ç›˜ & ç½‘ç»œ
                    </div>
                    <button class="refresh-btn" onclick="loadResourceUsage()">åˆ·æ–°</button>
                </div>
                <div id="diskNetworkContent">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- çˆ¬è™«è¿›ç¨‹ç®¡ç† -->
        <div class="monitor-card full-width">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">ğŸ•·ï¸</span>
                    çˆ¬è™«è¿›ç¨‹ç®¡ç†
                </div>
                <button class="refresh-btn" onclick="loadCrawlerProcesses()">åˆ·æ–°</button>
            </div>
            <div id="processContent">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- ç³»ç»Ÿç»Ÿè®¡ -->
        <div class="monitor-card full-width">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">ğŸ“ˆ</span>
                    ç³»ç»Ÿç»Ÿè®¡
                </div>
                <button class="refresh-btn" onclick="loadSystemStats()">åˆ·æ–°</button>
            </div>
            <div id="statsContent">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let isAutoRefreshEnabled = false;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllData() {
            await Promise.all([
                loadSystemHealth(),
                loadResourceUsage(),
                loadCrawlerProcesses(),
                loadSystemStats()
            ]);
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAllData() {
            await loadAllData();
        }

        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            if (isAutoRefreshEnabled) {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                isAutoRefreshEnabled = false;
                document.querySelector('.control-btn.secondary').textContent = 'â±ï¸ è‡ªåŠ¨åˆ·æ–°';
            } else {
                autoRefreshInterval = setInterval(loadAllData, 10000); // æ¯10ç§’åˆ·æ–°
                isAutoRefreshEnabled = true;
                document.querySelector('.control-btn.secondary').textContent = 'â¹ï¸ åœæ­¢åˆ·æ–°';
            }
        }

        // åŠ è½½ç³»ç»Ÿå¥åº·çŠ¶æ€
        async function loadSystemHealth() {
            try {
                const response = await fetch('/api/v1/system/health');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const healthData = data.data || data;
                    displaySystemHealth(healthData);
                } else {
                    throw new Error(data.message || 'è·å–å¥åº·çŠ¶æ€å¤±è´¥');
                }
            } catch (error) {
                displayError('healthContent', 'è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºç³»ç»Ÿå¥åº·çŠ¶æ€
        function displaySystemHealth(data) {
            const healthContent = document.getElementById('healthContent');
            
            let statusClass = 'health-healthy';
            let statusIcon = 'âœ…';
            if (data.status === 'warning') {
                statusClass = 'health-warning';
                statusIcon = 'âš ï¸';
            } else if (data.status === 'error') {
                statusClass = 'health-error';
                statusIcon = 'âŒ';
            }

            let warningsHtml = '';
            if (data.warnings && data.warnings.length > 0) {
                warningsHtml = '<ul class="warning-list">';
                data.warnings.forEach(warning => {
                    warningsHtml += `<li class="warning-item">${warning}</li>`;
                });
                warningsHtml += '</ul>';
            } else {
                warningsHtml = '<p style="color: #28a745;">âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œæ— è­¦å‘Šä¿¡æ¯</p>';
            }

            healthContent.innerHTML = `
                <div class="health-status ${statusClass}">
                    <span style="font-size: 1.5em;">${statusIcon}</span>
                    <div>
                        <strong>ç³»ç»ŸçŠ¶æ€: ${data.status === 'healthy' ? 'å¥åº·' : data.status === 'warning' ? 'è­¦å‘Š' : 'é”™è¯¯'}</strong><br>
                        <small>æ›´æ–°æ—¶é—´: ${new Date(data.timestamp).toLocaleString()}</small>
                    </div>
                </div>
                ${warningsHtml}
            `;
        }

        // åŠ è½½èµ„æºä½¿ç”¨æƒ…å†µ
        async function loadResourceUsage() {
            try {
                const response = await fetch('/api/v1/system/resources');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const resourceData = data.data || data;
                    displayResourceUsage(resourceData);
                } else {
                    throw new Error(data.message || 'è·å–èµ„æºä½¿ç”¨æƒ…å†µå¤±è´¥');
                }
            } catch (error) {
                displayError('cpuMemoryContent', 'è·å–èµ„æºä½¿ç”¨æƒ…å†µå¤±è´¥: ' + error.message);
                displayError('diskNetworkContent', 'è·å–èµ„æºä½¿ç”¨æƒ…å†µå¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºèµ„æºä½¿ç”¨æƒ…å†µ
        function displayResourceUsage(data) {
            // CPUå’Œå†…å­˜
            const cpuMemoryContent = document.getElementById('cpuMemoryContent');
            const cpuPercent = data.cpu.percent;
            const memoryPercent = data.memory.percent;
            
            let cpuBarClass = 'progress-fill';
            if (cpuPercent > 80) cpuBarClass += ' danger';
            else if (cpuPercent > 60) cpuBarClass += ' warning';

            let memoryBarClass = 'progress-fill';
            if (memoryPercent > 85) memoryBarClass += ' danger';
            else if (memoryPercent > 70) memoryBarClass += ' warning';

            cpuMemoryContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${cpuPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">CPUä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.cpu.cores}</div>
                        <div class="metric-label">CPUæ ¸å¿ƒæ•°</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${memoryPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">å†…å­˜ä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.memory.used_gb.toFixed(1)}<span class="metric-unit">GB</span></div>
                        <div class="metric-label">å·²ç”¨å†…å­˜</div>
                    </div>
                </div>
                <div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>CPUä½¿ç”¨ç‡</span>
                            <span>${cpuPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${cpuBarClass}" style="width: ${cpuPercent}%"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>å†…å­˜ä½¿ç”¨ç‡</span>
                            <span>${memoryPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${memoryBarClass}" style="width: ${memoryPercent}%"></div>
                        </div>
                    </div>
                </div>
            `;

            // ç£ç›˜å’Œç½‘ç»œ
            const diskNetworkContent = document.getElementById('diskNetworkContent');
            const diskPercent = data.disk.percent;
            
            let diskBarClass = 'progress-fill';
            if (diskPercent > 90) diskBarClass += ' danger';
            else if (diskPercent > 80) diskBarClass += ' warning';

            diskNetworkContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${diskPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">ç£ç›˜ä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.disk.used_gb.toFixed(1)}<span class="metric-unit">GB</span></div>
                        <div class="metric-label">å·²ç”¨ç£ç›˜</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network.bytes_sent)}</div>
                        <div class="metric-label">å‘é€æµé‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network.bytes_recv)}</div>
                        <div class="metric-label">æ¥æ”¶æµé‡</div>
                    </div>
                </div>
                <div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ç£ç›˜ä½¿ç”¨ç‡</span>
                            <span>${diskPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${diskBarClass}" style="width: ${diskPercent}%"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ç½‘ç»œæ´»åŠ¨</span>
                            <span>${data.network.packets_sent + data.network.packets_recv} åŒ…</span>
                        </div>
                        <div style="font-size: 0.9em; color: #666;">
                            å‘é€: ${data.network.packets_sent} åŒ… | æ¥æ”¶: ${data.network.packets_recv} åŒ…
                        </div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½çˆ¬è™«è¿›ç¨‹
        async function loadCrawlerProcesses() {
            try {
                const response = await fetch('/api/v1/system/processes');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const processData = data.data || data;
                    displayCrawlerProcesses(processData);
                } else {
                    throw new Error(data.message || 'è·å–è¿›ç¨‹ä¿¡æ¯å¤±è´¥');
                }
            } catch (error) {
                displayError('processContent', 'è·å–çˆ¬è™«è¿›ç¨‹ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºçˆ¬è™«è¿›ç¨‹
        function displayCrawlerProcesses(data) {
            const processContent = document.getElementById('processContent');
            
            let processesHtml = '';
            if (data.crawler_processes && data.crawler_processes.length > 0) {
                processesHtml = '<div class="process-list">';
                data.crawler_processes.forEach(process => {
                    processesHtml += `
                        <div class="process-item">
                            <div class="process-info">
                                <div class="process-name">${process.name} (PID: ${process.pid})</div>
                                <div class="process-details">${process.cmdline}</div>
                            </div>
                            <div class="process-stats">
                                <div class="process-cpu">CPU: ${process.cpu_percent.toFixed(1)}%</div>
                                <div class="process-memory">å†…å­˜: ${process.memory_percent.toFixed(1)}%</div>
                            </div>
                        </div>
                    `;
                });
                processesHtml += '</div>';
            } else {
                processesHtml = '<p style="color: #666; text-align: center;">æš‚æ— çˆ¬è™«è¿›ç¨‹è¿è¡Œ</p>';
            }

            processContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${data.total_processes || 0}</div>
                        <div class="metric-label">æ€»è¿›ç¨‹æ•°</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.crawler_process_count || 0}</div>
                        <div class="metric-label">çˆ¬è™«è¿›ç¨‹æ•°</div>
                    </div>
                </div>
                <div>
                    <h4 style="margin-bottom: 15px;">çˆ¬è™«è¿›ç¨‹è¯¦æƒ…</h4>
                    ${processesHtml}
                </div>
            `;
        }

        // åŠ è½½ç³»ç»Ÿç»Ÿè®¡
        async function loadSystemStats() {
            try {
                const response = await fetch('/api/v1/system/stats');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const statsData = data.data || data;
                    displaySystemStats(statsData);
                } else {
                    throw new Error(data.message || 'è·å–ç³»ç»Ÿç»Ÿè®¡å¤±è´¥');
                }
            } catch (error) {
                displayError('statsContent', 'è·å–ç³»ç»Ÿç»Ÿè®¡å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºç³»ç»Ÿç»Ÿè®¡
        function displaySystemStats(data) {
            const statsContent = document.getElementById('statsContent');
            
            statsContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${data.cpu_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">CPUä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.memory_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">å†…å­˜ä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.disk_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">ç£ç›˜ä½¿ç”¨ç‡</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.process_count}</div>
                        <div class="metric-label">æ€»è¿›ç¨‹æ•°</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.crawler_processes.length}</div>
                        <div class="metric-label">çˆ¬è™«è¿›ç¨‹æ•°</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network_bytes_sent + data.network_bytes_recv)}</div>
                        <div class="metric-label">ç½‘ç»œæ€»æµé‡</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <p><strong>æ›´æ–°æ—¶é—´:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                    <p><strong>å†…å­˜è¯¦æƒ…:</strong> ${data.memory_used_gb.toFixed(1)}GB / ${data.memory_total_gb.toFixed(1)}GB</p>
                    <p><strong>ç£ç›˜è¯¦æƒ…:</strong> ${data.disk_used_gb.toFixed(1)}GB / ${data.disk_total_gb.toFixed(1)}GB</p>
                </div>
            `;
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function displayError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="error-message">âŒ ${message}</div>`;
        }

        // å¯¼å‡ºç³»ç»ŸæŠ¥å‘Š
        function exportSystemReport() {
            const report = {
                timestamp: new Date().toISOString(),
                title: 'MediaCrawler ç³»ç»Ÿç›‘æ§æŠ¥å‘Š',
                data: {
                    health: null,
                    resources: null,
                    processes: null,
                    stats: null
                }
            };

            // æ”¶é›†å½“å‰æ•°æ®
            Promise.all([
                fetch('/api/v1/system/health').then(r => r.json()),
                fetch('/api/v1/system/resources').then(r => r.json()),
                fetch('/api/v1/system/processes').then(r => r.json()),
                fetch('/api/v1/system/stats').then(r => r.json())
            ]).then(responses => {
                report.data.health = responses[0];
                report.data.resources = responses[1];
                report.data.processes = responses[2];
                report.data.stats = responses[3];

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `system_report_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('ç³»ç»ŸæŠ¥å‘Šå·²å¯¼å‡ºï¼');
            }).catch(error => {
                alert('å¯¼å‡ºæŠ¥å‘Šå¤±è´¥: ' + error.message);
            });
        }

        // å·¥å…·å‡½æ•°
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>
