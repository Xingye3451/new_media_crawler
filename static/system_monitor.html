<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≥ªÁªüÁõëÊéß - MediaCrawler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .monitor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .monitor-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
        }

        .metric-unit {
            font-size: 0.8em;
            color: #999;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        .process-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .process-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
        }

        .process-info {
            flex: 1;
        }

        .process-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .process-details {
            font-size: 0.85em;
            color: #666;
        }

        .process-stats {
            text-align: right;
        }

        .process-cpu {
            color: #dc3545;
            font-weight: bold;
        }

        .process-memory {
            color: #28a745;
            font-weight: bold;
        }

        .warning-list {
            list-style: none;
        }

        .warning-item {
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            margin-bottom: 8px;
            color: #856404;
        }

        .warning-item::before {
            content: "‚ö†Ô∏è ";
            margin-right: 8px;
        }

        .health-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .health-healthy {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .health-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .health-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            background: #667eea;
            color: white;
        }

        .control-btn:hover {
            background: #5a6fd8;
        }

        .control-btn.secondary {
            background: #6c757d;
        }

        .control-btn.secondary:hover {
            background: #5a6268;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .monitor-grid {
                grid-template-columns: 1fr;
            }
            
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">
        ‚Üê ËøîÂõûÈ¶ñÈ°µ
    </a>

    <div class="container">
        <div class="header">
            <h1>üìä Á≥ªÁªüÁõëÊéß</h1>
            <p>ÂÆûÊó∂ÁõëÊéßÁ≥ªÁªüËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ„ÄÅËøõÁ®ãÁä∂ÊÄÅÂíåÁ≥ªÁªüÂÅ•Â∫∑Â∫¶</p>
        </div>

        <!-- ÊéßÂà∂ÊåâÈíÆ -->
        <div class="controls">
            <button class="control-btn" onclick="refreshAllData()">
                üîÑ Âà∑Êñ∞Êï∞ÊçÆ
            </button>
            <button class="control-btn secondary" onclick="toggleAutoRefresh()">
                ‚è±Ô∏è Ëá™Âä®Âà∑Êñ∞
            </button>
            <button class="control-btn secondary" onclick="exportSystemReport()">
                üì§ ÂØºÂá∫Êä•Âëä
            </button>
        </div>

        <!-- Á≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ -->
        <div class="monitor-card full-width" id="healthCard">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">üè•</span>
                    Á≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ
                </div>
                <button class="refresh-btn" onclick="loadSystemHealth()">Âà∑Êñ∞</button>
            </div>
            <div id="healthContent">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>

        <!-- ËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ -->
        <div class="monitor-grid">
            <!-- CPUÂíåÂÜÖÂ≠ò -->
            <div class="monitor-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üñ•Ô∏è</span>
                        CPU & ÂÜÖÂ≠ò
                    </div>
                    <button class="refresh-btn" onclick="loadResourceUsage()">Âà∑Êñ∞</button>
                </div>
                <div id="cpuMemoryContent">
                    <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>

            <!-- Á£ÅÁõòÂíåÁΩëÁªú -->
            <div class="monitor-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="card-icon">üíæ</span>
                        Á£ÅÁõò & ÁΩëÁªú
                    </div>
                    <button class="refresh-btn" onclick="loadResourceUsage()">Âà∑Êñ∞</button>
                </div>
                <div id="diskNetworkContent">
                    <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                </div>
            </div>
        </div>

        <!-- Áà¨Ëô´ËøõÁ®ãÁÆ°ÁêÜ -->
        <div class="monitor-card full-width">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">üï∑Ô∏è</span>
                    Áà¨Ëô´ËøõÁ®ãÁÆ°ÁêÜ
                </div>
                <button class="refresh-btn" onclick="loadCrawlerProcesses()">Âà∑Êñ∞</button>
            </div>
            <div id="processContent">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>

        <!-- Á≥ªÁªüÁªüËÆ° -->
        <div class="monitor-card full-width">
            <div class="card-header">
                <div class="card-title">
                    <span class="card-icon">üìà</span>
                    Á≥ªÁªüÁªüËÆ°
                </div>
                <button class="refresh-btn" onclick="loadSystemStats()">Âà∑Êñ∞</button>
            </div>
            <div id="statsContent">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let isAutoRefreshEnabled = false;

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });

        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆ
        async function loadAllData() {
            await Promise.all([
                loadSystemHealth(),
                loadResourceUsage(),
                loadCrawlerProcesses(),
                loadSystemStats()
            ]);
        }

        // Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆ
        async function refreshAllData() {
            await loadAllData();
        }

        // ÂàáÊç¢Ëá™Âä®Âà∑Êñ∞
        function toggleAutoRefresh() {
            if (isAutoRefreshEnabled) {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                isAutoRefreshEnabled = false;
                document.querySelector('.control-btn.secondary').textContent = '‚è±Ô∏è Ëá™Âä®Âà∑Êñ∞';
            } else {
                autoRefreshInterval = setInterval(loadAllData, 10000); // ÊØè10ÁßíÂà∑Êñ∞
                isAutoRefreshEnabled = true;
                document.querySelector('.control-btn.secondary').textContent = '‚èπÔ∏è ÂÅúÊ≠¢Âà∑Êñ∞';
            }
        }

        // Âä†ËΩΩÁ≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ
        async function loadSystemHealth() {
            try {
                const response = await fetch('/api/v1/system/health');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const healthData = data.data || data;
                    displaySystemHealth(healthData);
                } else {
                    throw new Error(data.message || 'Ëé∑ÂèñÂÅ•Â∫∑Áä∂ÊÄÅÂ§±Ë¥•');
                }
            } catch (error) {
                displayError('healthContent', 'Ëé∑ÂèñÁ≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÊòæÁ§∫Á≥ªÁªüÂÅ•Â∫∑Áä∂ÊÄÅ
        function displaySystemHealth(data) {
            const healthContent = document.getElementById('healthContent');
            
            let statusClass = 'health-healthy';
            let statusIcon = '‚úÖ';
            if (data.status === 'warning') {
                statusClass = 'health-warning';
                statusIcon = '‚ö†Ô∏è';
            } else if (data.status === 'error') {
                statusClass = 'health-error';
                statusIcon = '‚ùå';
            }

            let warningsHtml = '';
            if (data.warnings && data.warnings.length > 0) {
                warningsHtml = '<ul class="warning-list">';
                data.warnings.forEach(warning => {
                    warningsHtml += `<li class="warning-item">${warning}</li>`;
                });
                warningsHtml += '</ul>';
            } else {
                warningsHtml = '<p style="color: #28a745;">‚úÖ Á≥ªÁªüËøêË°åÊ≠£Â∏∏ÔºåÊó†Ë≠¶Âëä‰ø°ÊÅØ</p>';
            }

            healthContent.innerHTML = `
                <div class="health-status ${statusClass}">
                    <span style="font-size: 1.5em;">${statusIcon}</span>
                    <div>
                        <strong>Á≥ªÁªüÁä∂ÊÄÅ: ${data.status === 'healthy' ? 'ÂÅ•Â∫∑' : data.status === 'warning' ? 'Ë≠¶Âëä' : 'ÈîôËØØ'}</strong><br>
                        <small>Êõ¥Êñ∞Êó∂Èó¥: ${new Date(data.timestamp).toLocaleString()}</small>
                    </div>
                </div>
                ${warningsHtml}
            `;
        }

        // Âä†ËΩΩËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ
        async function loadResourceUsage() {
            try {
                const response = await fetch('/api/v1/system/resources');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const resourceData = data.data || data;
                    displayResourceUsage(resourceData);
                } else {
                    throw new Error(data.message || 'Ëé∑ÂèñËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµÂ§±Ë¥•');
                }
            } catch (error) {
                displayError('cpuMemoryContent', 'Ëé∑ÂèñËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµÂ§±Ë¥•: ' + error.message);
                displayError('diskNetworkContent', 'Ëé∑ÂèñËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÊòæÁ§∫ËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ
        function displayResourceUsage(data) {
            // CPUÂíåÂÜÖÂ≠ò
            const cpuMemoryContent = document.getElementById('cpuMemoryContent');
            const cpuPercent = data.cpu.percent;
            const memoryPercent = data.memory.percent;
            
            let cpuBarClass = 'progress-fill';
            if (cpuPercent > 80) cpuBarClass += ' danger';
            else if (cpuPercent > 60) cpuBarClass += ' warning';

            let memoryBarClass = 'progress-fill';
            if (memoryPercent > 85) memoryBarClass += ' danger';
            else if (memoryPercent > 70) memoryBarClass += ' warning';

            cpuMemoryContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${cpuPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">CPU‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.cpu.cores}</div>
                        <div class="metric-label">CPUÊ†∏ÂøÉÊï∞</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${memoryPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">ÂÜÖÂ≠ò‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.memory.used_gb.toFixed(1)}<span class="metric-unit">GB</span></div>
                        <div class="metric-label">Â∑≤Áî®ÂÜÖÂ≠ò</div>
                    </div>
                </div>
                <div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>CPU‰ΩøÁî®Áéá</span>
                            <span>${cpuPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${cpuBarClass}" style="width: ${cpuPercent}%"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ÂÜÖÂ≠ò‰ΩøÁî®Áéá</span>
                            <span>${memoryPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${memoryBarClass}" style="width: ${memoryPercent}%"></div>
                        </div>
                    </div>
                </div>
            `;

            // Á£ÅÁõòÂíåÁΩëÁªú
            const diskNetworkContent = document.getElementById('diskNetworkContent');
            const diskPercent = data.disk.percent;
            
            let diskBarClass = 'progress-fill';
            if (diskPercent > 90) diskBarClass += ' danger';
            else if (diskPercent > 80) diskBarClass += ' warning';

            diskNetworkContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${diskPercent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">Á£ÅÁõò‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.disk.used_gb.toFixed(1)}<span class="metric-unit">GB</span></div>
                        <div class="metric-label">Â∑≤Áî®Á£ÅÁõò</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network.bytes_sent)}</div>
                        <div class="metric-label">ÂèëÈÄÅÊµÅÈáè</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network.bytes_recv)}</div>
                        <div class="metric-label">Êé•Êî∂ÊµÅÈáè</div>
                    </div>
                </div>
                <div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Á£ÅÁõò‰ΩøÁî®Áéá</span>
                            <span>${diskPercent.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="${diskBarClass}" style="width: ${diskPercent}%"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>ÁΩëÁªúÊ¥ªÂä®</span>
                            <span>${data.network.packets_sent + data.network.packets_recv} ÂåÖ</span>
                        </div>
                        <div style="font-size: 0.9em; color: #666;">
                            ÂèëÈÄÅ: ${data.network.packets_sent} ÂåÖ | Êé•Êî∂: ${data.network.packets_recv} ÂåÖ
                        </div>
                    </div>
                </div>
            `;
        }

        // Âä†ËΩΩÁà¨Ëô´ËøõÁ®ã
        async function loadCrawlerProcesses() {
            try {
                const response = await fetch('/api/v1/system/processes');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const processData = data.data || data;
                    displayCrawlerProcesses(processData);
                } else {
                    throw new Error(data.message || 'Ëé∑ÂèñËøõÁ®ã‰ø°ÊÅØÂ§±Ë¥•');
                }
            } catch (error) {
                displayError('processContent', 'Ëé∑ÂèñÁà¨Ëô´ËøõÁ®ã‰ø°ÊÅØÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÊòæÁ§∫Áà¨Ëô´ËøõÁ®ã
        function displayCrawlerProcesses(data) {
            const processContent = document.getElementById('processContent');
            
            let processesHtml = '';
            if (data.crawler_processes && data.crawler_processes.length > 0) {
                processesHtml = '<div class="process-list">';
                data.crawler_processes.forEach(process => {
                    processesHtml += `
                        <div class="process-item">
                            <div class="process-info">
                                <div class="process-name">${process.name} (PID: ${process.pid})</div>
                                <div class="process-details">${process.cmdline}</div>
                            </div>
                            <div class="process-stats">
                                <div class="process-cpu">CPU: ${process.cpu_percent.toFixed(1)}%</div>
                                <div class="process-memory">ÂÜÖÂ≠ò: ${process.memory_percent.toFixed(1)}%</div>
                            </div>
                        </div>
                    `;
                });
                processesHtml += '</div>';
            } else {
                processesHtml = '<p style="color: #666; text-align: center;">ÊöÇÊó†Áà¨Ëô´ËøõÁ®ãËøêË°å</p>';
            }

            processContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${data.total_processes || 0}</div>
                        <div class="metric-label">ÊÄªËøõÁ®ãÊï∞</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.crawler_process_count || 0}</div>
                        <div class="metric-label">Áà¨Ëô´ËøõÁ®ãÊï∞</div>
                    </div>
                </div>
                <div>
                    <h4 style="margin-bottom: 15px;">Áà¨Ëô´ËøõÁ®ãËØ¶ÊÉÖ</h4>
                    ${processesHtml}
                </div>
            `;
        }

        // Âä†ËΩΩÁ≥ªÁªüÁªüËÆ°
        async function loadSystemStats() {
            try {
                const response = await fetch('/api/v1/system/stats');
                const data = await response.json();
                
                if (data.code === 200 || response.ok) {
                    const statsData = data.data || data;
                    displaySystemStats(statsData);
                } else {
                    throw new Error(data.message || 'Ëé∑ÂèñÁ≥ªÁªüÁªüËÆ°Â§±Ë¥•');
                }
            } catch (error) {
                displayError('statsContent', 'Ëé∑ÂèñÁ≥ªÁªüÁªüËÆ°Â§±Ë¥•: ' + error.message);
            }
        }

        // ÊòæÁ§∫Á≥ªÁªüÁªüËÆ°
        function displaySystemStats(data) {
            const statsContent = document.getElementById('statsContent');
            
            statsContent.innerHTML = `
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value">${data.cpu_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">CPU‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.memory_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">ÂÜÖÂ≠ò‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.disk_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                        <div class="metric-label">Á£ÅÁõò‰ΩøÁî®Áéá</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.process_count}</div>
                        <div class="metric-label">ÊÄªËøõÁ®ãÊï∞</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${data.crawler_processes.length}</div>
                        <div class="metric-label">Áà¨Ëô´ËøõÁ®ãÊï∞</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">${formatBytes(data.network_bytes_sent + data.network_bytes_recv)}</div>
                        <div class="metric-label">ÁΩëÁªúÊÄªÊµÅÈáè</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <p><strong>Êõ¥Êñ∞Êó∂Èó¥:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                    <p><strong>ÂÜÖÂ≠òËØ¶ÊÉÖ:</strong> ${data.memory_used_gb.toFixed(1)}GB / ${data.memory_total_gb.toFixed(1)}GB</p>
                    <p><strong>Á£ÅÁõòËØ¶ÊÉÖ:</strong> ${data.disk_used_gb.toFixed(1)}GB / ${data.disk_total_gb.toFixed(1)}GB</p>
                </div>
            `;
        }

        // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
        function displayError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="error-message">‚ùå ${message}</div>`;
        }

        // ÂØºÂá∫Á≥ªÁªüÊä•Âëä
        function exportSystemReport() {
            const report = {
                timestamp: new Date().toISOString(),
                title: 'MediaCrawler Á≥ªÁªüÁõëÊéßÊä•Âëä',
                data: {
                    health: null,
                    resources: null,
                    processes: null,
                    stats: null
                }
            };

            // Êî∂ÈõÜÂΩìÂâçÊï∞ÊçÆ
            Promise.all([
                fetch('/api/v1/system/health').then(r => r.json()),
                fetch('/api/v1/system/resources').then(r => r.json()),
                fetch('/api/v1/system/processes').then(r => r.json()),
                fetch('/api/v1/system/stats').then(r => r.json())
            ]).then(responses => {
                report.data.health = responses[0];
                report.data.resources = responses[1];
                report.data.processes = responses[2];
                report.data.stats = responses[3];

                // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `system_report_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('Á≥ªÁªüÊä•ÂëäÂ∑≤ÂØºÂá∫ÔºÅ');
            }).catch(error => {
                alert('ÂØºÂá∫Êä•ÂëäÂ§±Ë¥•: ' + error.message);
            });
        }

        // Â∑•ÂÖ∑ÂáΩÊï∞
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜÂÆöÊó∂Âô®
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>
