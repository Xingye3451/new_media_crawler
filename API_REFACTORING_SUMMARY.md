# MediaCrawler API é‡æ„æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡

å°†åŸæœ¬è¿‡äºåºå¤§çš„ `api_server.py` æ–‡ä»¶è¿›è¡Œåˆç†çš„æ¨¡å—åŒ–æ‹†åˆ†ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ“ é‡æ„åçš„ç›®å½•ç»“æ„

```
api/
â”œâ”€â”€ routes.py                    # è·¯ç”±èšåˆæ–‡ä»¶
â”œâ”€â”€ crawler_core.py             # çˆ¬è™«æ ¸å¿ƒè·¯ç”±
â”œâ”€â”€ content_management.py       # å†…å®¹ç®¡ç†è·¯ç”±
â”œâ”€â”€ platform_management.py      # å¹³å°ç®¡ç†è·¯ç”±
â”œâ”€â”€ system_management.py        # ç³»ç»Ÿç®¡ç†è·¯ç”±
â”œâ”€â”€ task_management.py          # ä»»åŠ¡ç®¡ç†è·¯ç”± (å·²å­˜åœ¨)
â”œâ”€â”€ task_results.py             # ä»»åŠ¡ç»“æœè·¯ç”± (å·²å­˜åœ¨)
â”œâ”€â”€ video_downloads.py          # è§†é¢‘ä¸‹è½½è·¯ç”± (å·²å­˜åœ¨)
â”œâ”€â”€ file_management.py          # æ–‡ä»¶ç®¡ç†è·¯ç”± (å·²å­˜åœ¨)
â”œâ”€â”€ minio_management.py         # MinIOç®¡ç†è·¯ç”± (å·²å­˜åœ¨)
â”œâ”€â”€ account_management.py       # è´¦å·ç®¡ç†è·¯ç”± (å·²å­˜åœ¨)
â””â”€â”€ login_management.py         # ç™»å½•ç®¡ç†è·¯ç”± (å·²å­˜åœ¨)
```

## ğŸ”§ é‡æ„å†…å®¹

### 1. çˆ¬è™«æ ¸å¿ƒæ¨¡å— (`api/crawler_core.py`)
**åŠŸèƒ½**: çˆ¬è™«ä»»åŠ¡çš„æ ¸å¿ƒåŠŸèƒ½
- âœ… çˆ¬è™«ä»»åŠ¡å¯åŠ¨ (`POST /api/v1/crawler/start`)
- âœ… ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ (`GET /api/v1/crawler/status/{task_id}`)
- âœ… ä»»åŠ¡åˆ—è¡¨æŸ¥è¯¢ (`GET /api/v1/crawler/tasks`)
- âœ… ä»»åŠ¡åˆ é™¤ (`DELETE /api/v1/crawler/tasks/{task_id}`)
- âœ… çˆ¬è™«å·¥å‚ç±» (`CrawlerFactory`)
- âœ… ä»»åŠ¡è®°å½•åˆ›å»º (`create_task_record`)
- âœ… ä»»åŠ¡è¿›åº¦æ›´æ–° (`update_task_progress`)
- âœ… ä»»åŠ¡æ—¥å¿—è®°å½• (`log_task_step`)
- âœ… åå°ä»»åŠ¡æ‰§è¡Œ (`run_crawler_task`)

### 2. å†…å®¹ç®¡ç†æ¨¡å— (`api/content_management.py`)
**åŠŸèƒ½**: å†…å®¹æŸ¥è¯¢å’Œç®¡ç†
- âœ… å†…å®¹åˆ—è¡¨æŸ¥è¯¢ (`POST /api/v1/content/list`)
- âœ… å†…å®¹è¯¦æƒ…è·å– (`GET /api/v1/content/{platform}/{content_id}`)
- âœ… å¹³å°ä¿¡æ¯ç»Ÿè®¡ (`GET /api/v1/content/platforms`)
- âœ… çŸ­è§†é¢‘å†…å®¹æŸ¥è¯¢ (`POST /api/v1/content/videos`)
- âœ… è§†é¢‘å¹³å°ä¿¡æ¯ (`GET /api/v1/content/video-platforms`)
- âœ… ç»Ÿä¸€å†…å®¹è½¬æ¢ (`convert_to_unified_content`)
- âœ… æ•°æ®åº“å†…å®¹æŸ¥è¯¢ (`get_unified_content_from_db`)

### 3. å¹³å°ç®¡ç†æ¨¡å— (`api/platform_management.py`)
**åŠŸèƒ½**: å¹³å°ä¿¡æ¯å’Œä»£ç†ç®¡ç†
- âœ… æ”¯æŒå¹³å°åˆ—è¡¨ (`GET /api/v1/platforms`)
- âœ… å¤šå¹³å°ä¿¡æ¯ (`GET /api/v1/multi-platform/info`)
- âœ… å¿«é€Ÿè·å–ä»£ç† (`GET /api/v1/proxy/quick-get`)
- âœ… ä»£ç†ç»Ÿè®¡ä¿¡æ¯ (`GET /api/v1/proxy/quick-stats`)
- âœ… å¹³å°è´¦å·åˆ—è¡¨ (`GET /api/v1/accounts/{platform}`)
- âœ… è´¦å·å‡­è¯æ£€æŸ¥ (`GET /api/v1/accounts/{platform}/validity`)
- âœ… è¿‡æœŸå‡­è¯æ¸…ç† (`POST /api/v1/tokens/cleanup`)
- âœ… è°ƒåº¦å™¨çŠ¶æ€ (`GET /api/v1/scheduler/status`)
- âœ… è°ƒåº¦å™¨æ§åˆ¶ (`POST /api/v1/scheduler/start|stop`)

### 4. ç³»ç»Ÿç®¡ç†æ¨¡å— (`api/system_management.py`)
**åŠŸèƒ½**: ç³»ç»Ÿç›‘æ§å’Œç®¡ç†
- âœ… æ ¹è·¯å¾„ä¿¡æ¯ (`GET /`)
- âœ… å¥åº·æ£€æŸ¥ (`GET /health`)
- âœ… æ•°æ®åº“åˆå§‹åŒ– (`POST /api/v1/database/init`)
- âœ… æ•°æ®åº“çŠ¶æ€ (`GET /api/v1/database/status`)
- âœ… æ•°æ®åº“å‡çº§ (`POST /api/v1/database/upgrade`)
- âœ… é…ç½®çŠ¶æ€ (`GET /api/v1/config/status`)
- âœ… ç³»ç»Ÿä¿¡æ¯ (`GET /api/v1/system/info`)
- âœ… æœ€è¿‘æ—¥å¿— (`GET /api/v1/logs/recent`)
- âœ… ç³»ç»Ÿé‡å¯ (`POST /api/v1/system/restart`)

### 5. è·¯ç”±èšåˆæ–‡ä»¶ (`api/routes.py`)
**åŠŸèƒ½**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è·¯ç”±
- âœ… å¯¼å…¥æ‰€æœ‰è·¯ç”±æ¨¡å—
- âœ… è®¾ç½®è·¯ç”±å‰ç¼€å’Œæ ‡ç­¾
- âœ… ç»Ÿä¸€çš„è·¯ç”±æ³¨å†Œ

### 6. ç®€åŒ–çš„ä¸»æœåŠ¡å™¨æ–‡ä»¶ (`api_server.py`)
**åŠŸèƒ½**: åº”ç”¨å…¥å£å’Œæ ¸å¿ƒé…ç½®
- âœ… FastAPI åº”ç”¨åˆ›å»º
- âœ… ä¸­é—´ä»¶é…ç½® (CORS)
- âœ… å¼‚å¸¸å¤„ç†å™¨
- âœ… å¯åŠ¨/å…³é—­äº‹ä»¶
- âœ… å¥åº·æ£€æŸ¥
- âœ… è·¯ç”±æ³¨å†Œ

## ğŸš€ é‡æ„ä¼˜åŠ¿

### 1. ä»£ç ç»„ç»‡æ›´æ¸…æ™°
- **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ç®¡ç†
- **èŒè´£åˆ†ç¦»**: ä¸åŒåŠŸèƒ½æœ‰ä¸åŒçš„è·¯ç”±æ–‡ä»¶
- **æ˜“äºç»´æŠ¤**: ä¿®æ”¹æŸä¸ªåŠŸèƒ½åªéœ€è¦ä¿®æ”¹å¯¹åº”æ¨¡å—

### 2. å¯æ‰©å±•æ€§æ›´å¼º
- **æ–°å¢åŠŸèƒ½**: åªéœ€åˆ›å»ºæ–°çš„è·¯ç”±æ¨¡å—
- **ç‹¬ç«‹å¼€å‘**: ä¸åŒæ¨¡å—å¯ä»¥å¹¶è¡Œå¼€å‘
- **ç‰ˆæœ¬æ§åˆ¶**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†

### 3. ä»£ç å¤ç”¨æ€§æ›´å¥½
- **å…±äº«å‡½æ•°**: é€šç”¨åŠŸèƒ½å¯ä»¥åœ¨æ¨¡å—é—´å…±äº«
- **ç»Ÿä¸€æ¥å£**: é€šè¿‡è·¯ç”±èšåˆç»Ÿä¸€ç®¡ç†
- **é…ç½®é›†ä¸­**: é…ç½®å’Œå¸¸é‡é›†ä¸­ç®¡ç†

### 4. è°ƒè¯•å’Œæµ‹è¯•æ›´å®¹æ˜“
- **æ¨¡å—æµ‹è¯•**: å¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸ªæ¨¡å—
- **é”™è¯¯å®šä½**: é”™è¯¯æ›´å®¹æ˜“å®šä½åˆ°å…·ä½“æ¨¡å—
- **æ—¥å¿—ç®¡ç†**: æ¯ä¸ªæ¨¡å—çš„æ—¥å¿—æ›´æ¸…æ™°

## ğŸ“Š é‡æ„å‰åå¯¹æ¯”

### é‡æ„å‰
- `api_server.py`: 2778è¡Œä»£ç 
- æ‰€æœ‰APIè·¯ç”±æ··åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
- éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•
- ä»£ç ç»“æ„æ··ä¹±

### é‡æ„å
- `api_server.py`: 222è¡Œä»£ç  (å‡å°‘92%)
- 8ä¸ªç‹¬ç«‹çš„è·¯ç”±æ¨¡å—
- æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ”„ è¿ç§»æŒ‡å—

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
# å¯åŠ¨APIæœåŠ¡å™¨
python api_server.py

# æˆ–è€…ä½¿ç”¨uvicorn
uvicorn api_server:app --host 0.0.0.0 --port 8000 --reload
```

### 2. APIç«¯ç‚¹å˜åŒ–
æ‰€æœ‰APIç«¯ç‚¹ä¿æŒä¸å˜ï¼Œåªæ˜¯å†…éƒ¨å®ç°è¢«é‡æ„åˆ°ä¸åŒæ¨¡å—ä¸­ï¼š

- **çˆ¬è™«ç›¸å…³**: `/api/v1/crawler/*` â†’ `api/crawler_core.py`
- **å†…å®¹ç›¸å…³**: `/api/v1/content/*` â†’ `api/content_management.py`
- **å¹³å°ç›¸å…³**: `/api/v1/platforms/*` â†’ `api/platform_management.py`
- **ç³»ç»Ÿç›¸å…³**: `/api/v1/system/*` â†’ `api/system_management.py`

### 3. æ•°æ®åº“è°ƒç”¨ä¿®å¤
- âœ… ä¿®å¤äº†æ‰€æœ‰ `db.execute` å’Œ `db.query` è°ƒç”¨
- âœ… ç»Ÿä¸€ä½¿ç”¨ `media_crawler_db_var.get()` è·å–æ•°æ®åº“è¿æ¥
- âœ… ç¡®ä¿æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½ä½¿ç”¨æ­£ç¡®çš„å¼‚æ­¥è¿æ¥

## ğŸ‰ é‡æ„å®Œæˆ

âœ… **ä»£ç æ¨¡å—åŒ–**: å°†2778è¡Œä»£ç æ‹†åˆ†ä¸º8ä¸ªç‹¬ç«‹æ¨¡å—  
âœ… **åŠŸèƒ½åˆ†ç¦»**: ä¸åŒåŠŸèƒ½æœ‰ä¸åŒçš„è·¯ç”±æ–‡ä»¶  
âœ… **æ•°æ®åº“ä¿®å¤**: ä¿®å¤äº†æ‰€æœ‰æ•°æ®åº“è°ƒç”¨é”™è¯¯  
âœ… **å¯¼å…¥ä¼˜åŒ–**: ç»Ÿä¸€äº†æ¨¡å‹å¯¼å…¥  
âœ… **æµ‹è¯•é€šè¿‡**: é‡æ„åçš„ä»£ç å¯ä»¥æ­£å¸¸å¯¼å…¥å’Œè¿è¡Œ  

## ğŸ“ åç»­å»ºè®®

1. **æ·»åŠ å•å…ƒæµ‹è¯•**: ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ ç‹¬ç«‹çš„å•å…ƒæµ‹è¯•
2. **APIæ–‡æ¡£**: ä½¿ç”¨FastAPIè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
3. **æ€§èƒ½ç›‘æ§**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—è®°å½•
4. **é”™è¯¯å¤„ç†**: å®Œå–„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·
5. **é…ç½®ç®¡ç†**: è¿›ä¸€æ­¥ä¼˜åŒ–é…ç½®ç®¡ç†

---

**é‡æ„å®Œæˆæ—¶é—´**: 2025-07-18  
**é‡æ„è´Ÿè´£äºº**: AI Assistant  
**ä»£ç è´¨é‡**: æ˜¾è‘—æå‡  
**ç»´æŠ¤æ€§**: å¤§å¹…æ”¹å–„ 