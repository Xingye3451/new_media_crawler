# MediaCrawler æ•°æ®åº“å‡çº§æŒ‡å—

## æ¦‚è¿°

æœ¬æ¬¡å‡çº§ä¸º MediaCrawler é¡¹ç›®æ·»åŠ äº†å®Œæ•´çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. **ä»»åŠ¡ç®¡ç†è¡¨ç»“æ„æ‰©å±•** - æ”¯æŒä»»åŠ¡æ”¶è—ã€ç½®é¡¶ã€åˆ é™¤ç­‰åŠŸèƒ½
2. **è§†é¢‘æ•°æ®è¡¨ç»“æ„æ‰©å±•** - æ”¯æŒè§†é¢‘æ”¶è—ã€MinIOå­˜å‚¨ã€ä»»åŠ¡å…³è”ç­‰åŠŸèƒ½
3. **ä»»åŠ¡æ—¥å¿—è®°å½•** - è¯¦ç»†è®°å½•ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹
4. **å•å¹³å°çˆ¬å–æ•°æ®å­˜å‚¨** - çˆ¬å–çš„æ•°æ®ç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“

## å‡çº§æ­¥éª¤

### 1. å¤‡ä»½æ•°æ®åº“ï¼ˆæ¨èï¼‰

åœ¨å‡çº§å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½ç°æœ‰æ•°æ®åº“ï¼š

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -h localhost -u root -p mediacrawler > backup_mediacrawler_$(date +%Y%m%d_%H%M%S).sql
```

### 2. æ‰§è¡Œæ•°æ®åº“å‡çº§

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å‡çº§è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œå‡çº§è„šæœ¬
python upgrade_database.py
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ‰§è¡ŒSQL

```bash
# è¿æ¥åˆ°MySQLå¹¶æ‰§è¡Œå‡çº§SQL
mysql -h localhost -u root -p mediacrawler < database_upgrade.sql
```

### 3. éªŒè¯å‡çº§ç»“æœ

å‡çº§å®Œæˆåï¼Œå¯ä»¥æ£€æŸ¥ä»¥ä¸‹è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®ï¼š

```sql
-- æ£€æŸ¥crawler_tasksè¡¨çš„æ–°å­—æ®µ
DESCRIBE crawler_tasks;

-- æ£€æŸ¥douyin_awemeè¡¨çš„æ–°å­—æ®µ
DESCRIBE douyin_aweme;

-- æ£€æŸ¥ä»»åŠ¡ç»Ÿè®¡è§†å›¾
SELECT * FROM task_statistics;

-- æ£€æŸ¥è§†é¢‘ç»Ÿè®¡è§†å›¾
SELECT * FROM video_statistics;
```

## æ–°å¢åŠŸèƒ½è¯´æ˜

### 1. ä»»åŠ¡ç®¡ç†åŠŸèƒ½

#### crawler_tasks è¡¨æ–°å¢å­—æ®µï¼š
- `user_id` - ç”¨æˆ·ID
- `params` - ä»»åŠ¡å‚æ•°JSON
- `priority` - ä¼˜å…ˆçº§
- `is_favorite` - æ˜¯å¦æ”¶è—
- `deleted` - æ˜¯å¦åˆ é™¤
- `is_pinned` - æ˜¯å¦ç½®é¡¶
- `ip_address` - IPåœ°å€
- `user_security_id` - ç”¨æˆ·å®‰å…¨ID
- `user_signature` - ç”¨æˆ·ç­¾å

#### crawler_task_logs è¡¨ï¼š
- è®°å½•ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¯¦ç»†æ—¥å¿—
- æ”¯æŒä¸åŒæ—¥å¿—çº§åˆ«ï¼ˆDEBUG, INFO, WARN, ERRORï¼‰
- è®°å½•ä»»åŠ¡è¿›åº¦å’Œæ­¥éª¤ä¿¡æ¯

### 2. è§†é¢‘æ•°æ®åŠŸèƒ½

#### douyin_aweme è¡¨æ–°å¢å­—æ®µï¼š
- `video_play_url` - è§†é¢‘æ’­æ”¾åœ°å€
- `video_share_url` - è§†é¢‘åˆ†äº«åœ°å€
- `is_favorite` - æ˜¯å¦æ”¶è—
- `minio_url` - MinIOå­˜å‚¨åœ°å€
- `task_id` - å…³è”ä»»åŠ¡ID

#### å…¶ä»–å¹³å°è¡¨ä¹Ÿæ·»åŠ äº†ç±»ä¼¼å­—æ®µï¼š
- `xhs_note` - å°çº¢ä¹¦ç¬”è®°è¡¨
- `kuaishou_video` - å¿«æ‰‹è¡¨
- `bilibili_video` - Bç«™è¡¨
- `weibo_note` - å¾®åšè¡¨
- `tieba_note` - è´´å§è¡¨
- `zhihu_content` - çŸ¥ä¹è¡¨

### 3. ç»Ÿè®¡è§†å›¾

#### task_statistics è§†å›¾ï¼š
- æŒ‰å¹³å°ç»Ÿè®¡ä»»åŠ¡æ•°é‡
- ç»Ÿè®¡ä»»åŠ¡çŠ¶æ€åˆ†å¸ƒ
- è®¡ç®—å¹³å‡è¿›åº¦å’Œæ€»ç»“æœæ•°

#### video_statistics è§†å›¾ï¼š
- æŒ‰å¹³å°ç»Ÿè®¡è§†é¢‘æ•°é‡
- ç»Ÿè®¡æ”¶è—è§†é¢‘æ•°é‡
- ç»Ÿè®¡ä»»åŠ¡å…³è”è§†é¢‘æ•°é‡

## API åŠŸèƒ½å¢å¼º

### 1. å•å¹³å°çˆ¬å–å¢å¼º

ç°åœ¨å•å¹³å°çˆ¬å–ä»»åŠ¡ä¼šï¼š

1. **åˆ›å»ºä»»åŠ¡è®°å½•** - åœ¨ `crawler_tasks` è¡¨ä¸­åˆ›å»ºä»»åŠ¡è®°å½•
2. **è®°å½•æ‰§è¡Œæ—¥å¿—** - åœ¨ `crawler_task_logs` è¡¨ä¸­è®°å½•è¯¦ç»†æ—¥å¿—
3. **å­˜å‚¨è§†é¢‘æ•°æ®** - å°†çˆ¬å–çš„è§†é¢‘æ•°æ®å­˜å‚¨åˆ°å¯¹åº”å¹³å°çš„æ•°æ®è¡¨
4. **å­˜å‚¨è¯„è®ºæ•°æ®** - å°†çˆ¬å–çš„è¯„è®ºæ•°æ®å­˜å‚¨åˆ°å¯¹åº”å¹³å°çš„è¯„è®ºè¡¨
5. **æ›´æ–°ä»»åŠ¡è¿›åº¦** - å®æ—¶æ›´æ–°ä»»åŠ¡æ‰§è¡Œè¿›åº¦
6. **å…³è”ä»»åŠ¡ID** - è§†é¢‘æ•°æ®ä¸ä»»åŠ¡IDå…³è”

### 2. ä»»åŠ¡ç®¡ç†API

æ–°å¢çš„ä»»åŠ¡ç®¡ç†APIåŒ…æ‹¬ï¼š

- `GET /api/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `GET /api/tasks/{task_id}` - è·å–ä»»åŠ¡è¯¦æƒ…
- `POST /api/tasks/{task_id}/favorite` - æ”¶è—ä»»åŠ¡
- `POST /api/tasks/{task_id}/pin` - ç½®é¡¶ä»»åŠ¡
- `DELETE /api/tasks/{task_id}` - åˆ é™¤ä»»åŠ¡
- `GET /api/tasks/{task_id}/logs` - è·å–ä»»åŠ¡æ—¥å¿—

### 3. è§†é¢‘ç®¡ç†API

æ–°å¢çš„è§†é¢‘ç®¡ç†APIåŒ…æ‹¬ï¼š

- `GET /api/videos` - è·å–è§†é¢‘åˆ—è¡¨
- `GET /api/videos/{video_id}` - è·å–è§†é¢‘è¯¦æƒ…
- `POST /api/videos/{video_id}/favorite` - æ”¶è—è§†é¢‘
- `POST /api/videos/{video_id}/download` - ä¸‹è½½è§†é¢‘
- `POST /api/videos/{video_id}/save-to-minio` - ä¿å­˜åˆ°MinIO

## ä½¿ç”¨ç¤ºä¾‹

### 1. å¯åŠ¨å•å¹³å°çˆ¬å–ä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/api/v1/crawler/start" \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "dy",
    "keywords": "æµ‹è¯•å…³é”®è¯",
    "max_notes_count": 10,
    "get_comments": true,
    "save_data_option": "db"
  }'
```

### 2. æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨

```bash
curl "http://localhost:8000/api/tasks"
```

### 3. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…

```bash
curl "http://localhost:8000/api/tasks/{task_id}"
```

### 4. æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—

```bash
curl "http://localhost:8000/api/tasks/{task_id}/logs"
```

### 5. æ”¶è—ä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/api/tasks/{task_id}/favorite"
```

## æ•…éšœæ’é™¤

### 1. å‡çº§å¤±è´¥

å¦‚æœå‡çº§è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š

1. **æ£€æŸ¥æ•°æ®åº“è¿æ¥** - ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œ
2. **æ£€æŸ¥æƒé™** - ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
3. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—** - æ£€æŸ¥å…·ä½“çš„é”™è¯¯ä¿¡æ¯
4. **å›æ»šæ“ä½œ** - å¦‚æœæœ‰å¤‡ä»½ï¼Œå¯ä»¥æ¢å¤å¤‡ä»½

### 2. æ•°æ®ä¸å®Œæ•´

å¦‚æœå‡çº§åå‘ç°æ•°æ®ä¸å®Œæ•´ï¼š

1. **æ£€æŸ¥SQLæ‰§è¡Œ** - ç¡®è®¤æ‰€æœ‰SQLè¯­å¥éƒ½æ‰§è¡ŒæˆåŠŸ
2. **æ£€æŸ¥è¡¨ç»“æ„** - ä½¿ç”¨ `DESCRIBE` å‘½ä»¤æ£€æŸ¥è¡¨ç»“æ„
3. **é‡æ–°æ‰§è¡Œå‡çº§** - å¯ä»¥é‡æ–°è¿è¡Œå‡çº§è„šæœ¬

### 3. APIåŠŸèƒ½å¼‚å¸¸

å¦‚æœAPIåŠŸèƒ½å¼‚å¸¸ï¼š

1. **æ£€æŸ¥æ•°æ®åº“è¿æ¥** - ç¡®ä¿APIèƒ½æ­£å¸¸è¿æ¥æ•°æ®åº“
2. **æ£€æŸ¥è¡¨ç»“æ„** - ç¡®è®¤ç›¸å…³è¡¨ç»“æ„æ­£ç¡®
3. **æŸ¥çœ‹APIæ—¥å¿—** - æ£€æŸ¥APIæœåŠ¡çš„é”™è¯¯æ—¥å¿—
4. **é‡å¯æœåŠ¡** - é‡å¯APIæœåŠ¡

## æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½é‡è¦** - å‡çº§å‰åŠ¡å¿…å¤‡ä»½æ•°æ®åº“
2. **æµ‹è¯•ç¯å¢ƒ** - å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å‡çº§
3. **æ•°æ®å…¼å®¹** - å‡çº§åç°æœ‰æ•°æ®ä»ç„¶å¯ç”¨
4. **æ€§èƒ½å½±å“** - æ–°å¢å­—æ®µå’Œç´¢å¼•å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½
5. **å­˜å‚¨ç©ºé—´** - æ–°å¢å­—æ®µä¼šå¢åŠ å­˜å‚¨ç©ºé—´éœ€æ±‚

## è”ç³»æ”¯æŒ

å¦‚æœåœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹é¡¹ç›®æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥æ•°æ®åº“é”™è¯¯æ—¥å¿—
3. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**å‡çº§å®Œæˆåï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å®Œæ•´çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½äº†ï¼** ğŸ‰ 